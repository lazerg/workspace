<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/json.min.js"></script>

<style>
    pre {
        white-space: pre-wrap;
        word-break: break-all;
        padding: 1em;
        border-radius: 5px;
        background: #f5f5f5;
        overflow-x: auto;
    }
</style>

<body>
<h1>OAuth2 Token Response</h1>
<pre id="result">Waiting for token...</pre>

<script>
    const params = new URLSearchParams(window.location.search);

    const env = {
        code: params.get('code'),
        client_id: params.get('client_id'),
        client_secret: params.get('client_secret'),
        domain: document.referrer,
        redirect_uri: window.location.href.split('&code')[0],
    }

    fetch(`${env.domain}oauth2/token`, {
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded",
        },
        body: new URLSearchParams({
            "grant_type": "authorization_code",
            "client_id": env.client_id,
            "client_secret": env.client_secret,
            "code": env.code,
            "redirect_uri": env.redirect_uri,
        })
    })
        .then(res => res.json())
        .then(data => {
            document.getElementById('result').innerHTML = `
              <pre><code class="json">${hljs.highlight(JSON.stringify(data, null, 2), {language: 'json'}).value}</code></pre>
            `;
        })
        .catch(err => {
            document.getElementById('result').innerHTML = `
              <pre style="color: red;">Error: ${err}</pre>
            `;
        });
</script>
</body>
